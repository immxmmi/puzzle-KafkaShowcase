<canvas id="solarCanvas" width="1200" height="800"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const debugMode = false;
  const canvas = document.getElementById('solarCanvas');
  const ctx = canvas.getContext('2d');
  
  let solarInputPower = 0;
  
  async function fetchDataAndUpdate() {
    if (debugMode) {
      solarInputPower = Math.random() * 1000; // Simuliere zufÃ¤llige Leistung
      console.log("âš¡ [Debug] Simulated Solar Input Power:", solarInputPower);
      return;
    }
    const response = await fetch('/api/data');
    const data = await response.json();
    if (data.length > 0) {
      solarInputPower = data[data.length - 1].solarInputPower || 0;
      console.log("ðŸ”† Solar Input Power:", solarInputPower);
    }
  }
  
  function drawSparkles(centerX, centerY, count) {
    for (let i = 0; i < count; i++) {
      const angle = Math.random() * 2 * Math.PI;
      const distance = Math.random() * 100 + 50;
      const x = centerX + Math.cos(angle) * distance;
      const y = centerY + Math.sin(angle) * distance;
      ctx.beginPath();
      ctx.arc(x, y, 2 + Math.random() * 3, 0, 2 * Math.PI);
      ctx.fillStyle = 'rgba(255,255,0,0.8)';
      ctx.fill();
    }
  }

  function drawSun() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2.1;
    const baseRadius = 150;
    const dynamicRadius = baseRadius + solarInputPower / 5;
    const brightness = Math.min(1, solarInputPower / 200);
    
    ctx.fillStyle = `rgba(173,216,230,${1 - brightness * 0.5})`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    const gradient = ctx.createRadialGradient(centerX, centerY, dynamicRadius * 0.5, centerX, centerY, dynamicRadius);
    gradient.addColorStop(0, `rgba(255, 223, 0, 1)`);
    gradient.addColorStop(1, `rgba(255, 223, 0, ${1 - brightness * 0.7})`);
    
    ctx.beginPath();
    ctx.arc(centerX, centerY, dynamicRadius, 0, 2 * Math.PI);
    ctx.fillStyle = gradient;
    ctx.fill();

    const rayLength = dynamicRadius + 20;
    ctx.strokeStyle = `rgba(255, 223, 0, ${0.5 + brightness * 0.5})`;
    ctx.lineWidth = 2;
    for (let i = 0; i < 20; i++) {
      const angle = (i / 20) * 2 * Math.PI + (Date.now() * 0.001); // leicht drehend
      const startX = centerX + Math.cos(angle) * dynamicRadius * 0.9;
      const startY = centerY + Math.sin(angle) * dynamicRadius * 0.9;
      const endX = centerX + Math.cos(angle) * rayLength;
      const endY = centerY + Math.sin(angle) * rayLength;
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      ctx.lineTo(endX, endY);
      ctx.stroke();
    }

    if (solarInputPower > 100) {
      const sparkleCount = Math.floor(solarInputPower / 50);
      drawSparkles(centerX, centerY, sparkleCount);
    }
    
    requestAnimationFrame(drawSun);
  }
  
  fetchDataAndUpdate();
  setInterval(fetchDataAndUpdate, 5000);
  requestAnimationFrame(drawSun);
</script>